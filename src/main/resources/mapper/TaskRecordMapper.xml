<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eservice.api.dao.TaskRecordMapper">
  <resultMap id="BaseResultMap" type="com.eservice.api.model.task_record.TaskRecord">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="task_name" jdbcType="VARCHAR" property="taskName" />
    <result column="process_record_id" jdbcType="INTEGER" property="processRecordId" />
    <result column="node_key" jdbcType="TINYINT" property="nodeKey" />
    <result column="leader" jdbcType="VARCHAR" property="leader" />
    <result column="status" jdbcType="TINYINT" property="status" />
    <result column="begin_time" jdbcType="TIMESTAMP" property="beginTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="worker_list" jdbcType="LONGVARCHAR" property="workerList" />
  </resultMap>

  <!--根据user.account查 task_record OK-->
  <select id="selectTaskReocords" resultMap="BaseResultMap">
  select
  tr.*
  from task_record tr
  join task on task.task_name = tr.task_name
  join install_group  on install_group.id = task.group_id
  join user on user.group_id = install_group.id
  where user.account  = #{userAccount}
  </select>

  <resultMap id="taskPlanResultMap" type="com.eservice.api.model.task_plan.TaskPlan">
    <id column="id"  property="id" />
    <result column="task_name" jdbcType="VARCHAR" property="taskName" />
    <result column="group_id" jdbcType="INTEGER" property="groupId" />
    <result column="guidance" jdbcType="LONGVARCHAR" property="guidance" />
  </resultMap>

<!--根据 taskId查task plan-->
  <select id="selectTaskPlans" resultMap="taskPlanResultMap">
    select
    tp.*
    from task_plan tp
    join task_record  tr on tr.id = tp.task_record_id
    where tr.id = #{taskId}
  </select>

  <resultMap id="TaskRecordDetail" type="com.eservice.api.model.task_record.TaskRecordDetail">
    <id column="id" property="id" />
    <result column="task_name" jdbcType="VARCHAR" property="taskName" />
    <result column="process_record_id" jdbcType="INTEGER" property="processRecordId" />
    <result column="node_key" jdbcType="TINYINT" property="nodeKey" />
    <result column="leader" jdbcType="VARCHAR" property="leader" />
    <result column="status" jdbcType="TINYINT" property="status" />
    <result column="begin_time" jdbcType="TIMESTAMP" property="beginTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="worker_list" jdbcType="LONGVARCHAR" property="workerList" />
    <association javaType="com.eservice.api.model.process_record.ProcessRecord" property="processRecord" >
    <id column="process_record_id"  property="id" />
    <result column="machine_id" jdbcType="INTEGER" property="machineId" />
    <result column="process_id" jdbcType="INTEGER" property="processId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="link_data" jdbcType="LONGVARCHAR" property="linkData" />
    <result column="node_data" jdbcType="LONGVARCHAR" property="nodeData" />
    </association>
    <association javaType="com.eservice.api.model.machine.Machine" property="machine">
    <id column="machine_id1"  property="id" />
    <result column="order_id"  property="orderId" />
    <result column="machine_id" jdbcType="VARCHAR" property="machineId" />
    <result column="nameplate" jdbcType="VARCHAR" property="nameplate" />
    <result column="location" jdbcType="VARCHAR" property="location" />
    <result column="status" jdbcType="TINYINT" property="status" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="installed_time" jdbcType="TIMESTAMP" property="installedTime" />
    <result column="ship_time" jdbcType="TIMESTAMP" property="shipTime" />
    </association>
    <association javaType="com.eservice.api.model.machine_order.MachineOrder" property="machineOrder" >
      <id column="machine_order_id" jdbcType="INTEGER" property="id" />
      <result column="original_order_id" jdbcType="INTEGER" property="originalOrderId" />
      <result column="order_detail_id" jdbcType="INTEGER" property="orderDetailId" />
      <result column="create_user_id" jdbcType="INTEGER" property="createUserId" />
      <result column="contract_num" jdbcType="VARCHAR" property="contractNum" />
      <result column="customer" jdbcType="VARCHAR" property="customer" />
      <result column="country" jdbcType="VARCHAR" property="country" />
      <result column="brand" jdbcType="VARCHAR" property="brand" />
      <result column="machine_type" jdbcType="INTEGER" property="machineType" />
      <result column="needle_num" jdbcType="INTEGER" property="needleNum" />
      <result column="head_num" jdbcType="INTEGER" property="headNum" />
      <result column="head_distance" jdbcType="INTEGER" property="headDistance" />
      <result column="x_distance" jdbcType="VARCHAR" property="xDistance" />
      <result column="y_distance" jdbcType="VARCHAR" property="yDistance" />
      <result column="package_method" jdbcType="VARCHAR" property="packageMethod" />
      <result column="machine_num" jdbcType="TINYINT" property="machineNum" />
      <result column="machine_price" jdbcType="VARCHAR" property="machinePrice" />
      <result column="contract_ship_date" jdbcType="DATE" property="contractShipDate" />
      <result column="plan_ship_date" jdbcType="DATE" property="planShipDate" />
      <result column="sellman" jdbcType="VARCHAR" property="sellman" />
      <result column="status" jdbcType="TINYINT" property="status" />
      <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
      <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
      <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
      <result column="mark" jdbcType="LONGVARCHAR" property="mark" />
    </association>
    <association javaType="com.eservice.api.model.order_loading_list.OrderLoadingList" property="orderLoadingList">
      <id column="order_loading_list_id"  property="id" />
      <result column="order_id" jdbcType="INTEGER" property="orderId" />
      <result column="file_name" jdbcType="VARCHAR" property="fileName" />
      <result column="type" jdbcType="TINYINT" property="type" />
      <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    </association>

  </resultMap>
  <!--根据 taskId查task record, process record, machine, machine_order-->
  <select id="selectTaskRecordDetail" resultMap="TaskRecordDetail">
    SELECT tr.*, pr.*,
    m.id machine_id1, m.*, mo.id machine_order_id, mo.*,
    oll.*
    FROM
    task_record tr
    join process_record pr on tr.process_record_id = pr.id
    join machine m on m.id = pr.machine_id
    join machine_order mo on mo.id = m.order_id
    join order_loading_list oll on oll.order_id = mo.id
    where tr.id = #{taskRecordId}
  </select>
</mapper>